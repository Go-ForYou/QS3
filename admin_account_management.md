# 管理员账号管理说明

## 📋 当前管理员账号机制

### 1. **默认管理员账号**
- **用户名**：`admin`
- **密码**：`admin123`（或环境变量 `ADMIN_PASSWORD` 设置的值）
- **创建方式**：系统启动时自动创建
- **限制**：如果已存在管理员，不会重复创建

### 2. **多管理员账号支持**

#### ✅ 已实现功能
- **数据库支持**：用户表支持多个管理员账号
- **角色管理**：通过 `role` 字段区分管理员和作者
- **权限控制**：只有管理员可以创建新的管理员账号
- **用户管理**：管理员可以查看和删除其他管理员账号

#### 🔧 新增功能
1. **管理员注册**：
   - 只有已登录的管理员才能创建新的管理员账号
   - 注册页面会根据登录状态显示角色选择
   - 未登录用户只能注册为作者

2. **用户管理页面**：
   - 访问地址：`/admin/users`
   - 显示所有用户列表
   - 可以删除其他管理员账号（不能删除自己）

## 🗄️ 数据共享情况

### ✅ 所有管理员共享同一套数据
- **业务数据**：书籍、申请、稿费、通知等
- **用户数据**：所有用户信息
- **系统状态**：全局设置和配置

### 📊 数据表结构
```sql
-- 用户表
users (id, username, password_hash, role, created_at)

-- 业务数据表
books (id, title, author_id, pen_name, contract_type, buyout_amount, created_at)
applications (id, author_id, title, pen_name, contract_type, status, ...)
royalties (id, author_id, month, amount, book_id)
notifications (id, recipient_id, message, created_at, is_read)
```

## 🔐 权限管理

### 管理员权限
- ✅ 查看所有申请
- ✅ 审批/拒绝申请
- ✅ 管理书籍信息
- ✅ 设置稿费
- ✅ 查看所有用户
- ✅ 创建新管理员
- ✅ 删除其他管理员

### 作者权限
- ✅ 查看自己的申请
- ✅ 提交新申请
- ✅ 查看自己的书籍
- ✅ 查看自己的稿费
- ✅ 查看通知

## 🚀 使用指南

### 创建新管理员
1. 使用默认管理员账号登录
2. 访问注册页面：`/register`
3. 填写用户名和密码
4. 选择角色为"管理员"
5. 点击注册

### 管理用户
1. 登录管理员账号
2. 访问用户管理：`/admin/users`
3. 查看所有用户列表
4. 可以删除其他管理员账号

### 安全建议
1. **修改默认密码**：首次登录后立即修改默认密码
2. **限制管理员数量**：只创建必要的管理员账号
3. **定期清理**：删除不再需要的管理员账号
4. **密码强度**：使用强密码策略

## 🔧 技术实现

### 数据库兼容性
- **本地开发**：使用SQLite数据库
- **生产环境**：使用PostgreSQL数据库
- **自动切换**：根据环境自动选择数据库类型

### 权限验证
```python
@login_required(role="admin")  # 需要管理员权限
def admin_function():
    # 管理员功能
    pass
```

### 角色检查
```python
if session.get("role") != "admin":
    flash("只有管理员才能执行此操作", "error")
    return redirect(url_for("index"))
```

## 📈 扩展功能

### 可考虑添加的功能
1. **角色权限细化**：不同级别的管理员权限
2. **操作日志**：记录管理员的操作历史
3. **密码策略**：强制密码复杂度要求
4. **账号锁定**：登录失败次数限制
5. **双因素认证**：增强安全性

---

**总结：系统支持多个管理员账号，所有管理员共享同一套数据，管理员可以创建和删除其他管理员账号。**
